# æ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ã‚’ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«è¿½åŠ 

## æ¦‚è¦
ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«ã€Œæ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ã€ï¼ˆ`earlyLeaveStandardHour`ï¼‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ã“ã®è¨­å®šã«ã‚ˆã‚Šã€å®šæ™‚é€€å‹¤æ™‚åˆ»ã‚’åŸºæº–ã¨ã—ã¦æ—©é€€åˆ¤å®šãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

---

## ä¿®æ­£å†…å®¹

### 1. `/utils/api.ts`

#### âœ… `SystemSettings`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«è¿½åŠ 

```typescript
export interface SystemSettings {
  // åŠ´åƒæ™‚é–“è¨­å®š
  regularHoursPerDay: number;
  defaultBreakMinutes: number;
  breakMinutesFor6Hours: number;
  breakMinutesFor8Hours: number;

  // æ®‹æ¥­è¨­å®š
  overtimeThreshold: number;
  overtimeRate: number;
  excessOvertimeRate: number;
  lateNightRate: number;
  holidayRate: number;
  lateNightStartHour: number;
  lateNightEndHour: number;
  earlyOvertimeStandardHour: number; // æ—©å‡ºæ®‹æ¥­åŸºæº–æ™‚é–“ï¼ˆæ™‚ï¼‰
  earlyLeaveStandardHour: number;     // æ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ï¼ˆæ™‚ï¼‰ âœ¨ NEW

  // çµ¦ä¸è¨­å®š
  defaultHourlyRate: number;
}
```

#### âœ… `DEFAULT_SYSTEM_SETTINGS`ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿½åŠ 

```typescript
export const DEFAULT_SYSTEM_SETTINGS: SystemSettings = {
  regularHoursPerDay: 8,
  defaultBreakMinutes: 60,
  breakMinutesFor6Hours: 45,
  breakMinutesFor8Hours: 60,
  overtimeThreshold: 45,
  overtimeRate: 25,
  excessOvertimeRate: 50,
  lateNightRate: 25,
  holidayRate: 35,
  lateNightStartHour: 22,
  lateNightEndHour: 5,
  earlyOvertimeStandardHour: 9,
  earlyLeaveStandardHour: 17,  // âœ¨ NEW ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 17æ™‚
  defaultHourlyRate: 1200,
};
```

---

### 2. `/components/system-settings-page.tsx`

#### âœ… å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

æ·±å¤œæ™‚é–“å¸¯è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã€æ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

```typescript
<div>
  <Label htmlFor="earlyLeaveStandardHour">æ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ï¼ˆæ™‚ï¼‰</Label>
  <Input
    id="earlyLeaveStandardHour"
    type="number"
    min="0"
    max="23"
    value={settings.earlyLeaveStandardHour}
    onChange={(e) => updateSetting('earlyLeaveStandardHour', Number(e.target.value))}
    className="mt-1"
  />
  <p className="text-xs text-muted-foreground mt-1">
    ã“ã®æ™‚åˆ»ã‚ˆã‚Šå‰ã®é€€å‹¤ã‚’æ—©ä¸ŠãŒã‚Šã¨ã—ã¦æ‰±ã„ã¾ã™ï¼ˆä¾‹: 17æ™‚ï¼‰
  </p>
</div>
```

**é…ç½®å ´æ‰€**: ã€Œæ—©å‡ºæ®‹æ¥­åŸºæº–æ™‚é–“ã€ã®ä¸‹ã€æ·±å¤œæ™‚é–“å¸¯è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…

---

## è¨­å®šã®æ„å‘³

### earlyLeaveStandardHourï¼ˆæ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ï¼‰

| é …ç›® | å†…å®¹ |
|-----|------|
| **ç›®çš„** | å®šæ™‚é€€å‹¤æ™‚åˆ»ã‚’å®šç¾© |
| **åˆ¤å®šåŸºæº–** | ã“ã®æ™‚åˆ»ã‚ˆã‚Šå‰ã«é€€å‹¤ã—ãŸå ´åˆã€ã€Œæ—©é€€ã€ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ |
| **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤** | 17æ™‚ |
| **è¨­å®šç¯„å›²** | 0ã€œ23æ™‚ |
| **ä½¿ç”¨ç®‡æ‰€** | work-analysis APIï¼ˆæ—©é€€åˆ¤å®šï¼‰ |

---

## ä½¿ç”¨ä¾‹

### ã‚±ãƒ¼ã‚¹1: é€šå¸¸é€€å‹¤
```
è¨­å®š: earlyLeaveStandardHour = 17
é€€å‹¤æ™‚åˆ»: 17:00
â†’ æ—©é€€ã§ã¯ãªã„ï¼ˆé€šå¸¸é€€å‹¤ï¼‰
```

### ã‚±ãƒ¼ã‚¹2: æ—©ä¸ŠãŒã‚Š
```
è¨­å®š: earlyLeaveStandardHour = 17
é€€å‹¤æ™‚åˆ»: 16:30
â†’ æ—©é€€ã¨ã—ã¦åˆ¤å®šã•ã‚Œã‚‹
```

### ã‚±ãƒ¼ã‚¹3: æ®‹æ¥­
```
è¨­å®š: earlyLeaveStandardHour = 17
é€€å‹¤æ™‚åˆ»: 20:00
â†’ æ—©é€€ã§ã¯ãªã„ï¼ˆæ®‹æ¥­ï¼‰
```

---

## ä»–ã®è¨­å®šã¨ã®é–¢ä¿‚

### æ—©å‡ºæ®‹æ¥­åŸºæº–æ™‚é–“ã¨ã®å¯¾æ¯”

| è¨­å®šé …ç›® | æ„å‘³ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | åˆ¤å®šå†…å®¹ |
|---------|------|-------------|---------|
| `earlyOvertimeStandardHour` | å‡ºå‹¤æ™‚åˆ»ã®åŸºæº– | 9æ™‚ | ã“ã®æ™‚åˆ»ã‚ˆã‚Šå‰ã®å‡ºå‹¤ã‚’ã€Œæ—©å‡ºæ®‹æ¥­ã€ã¨åˆ¤å®š |
| `earlyLeaveStandardHour` | é€€å‹¤æ™‚åˆ»ã®åŸºæº– | 17æ™‚ | ã“ã®æ™‚åˆ»ã‚ˆã‚Šå‰ã®é€€å‹¤ã‚’ã€Œæ—©é€€ã€ã¨åˆ¤å®š |

### æ³•å®šåŠ´åƒæ™‚é–“ã¨ã®é–¢ä¿‚

```
æ—©å‡ºæ®‹æ¥­åŸºæº–æ™‚é–“: 9:00
æ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»: 17:00

æ¨™æº–å‹¤å‹™æ™‚é–“ = 17:00 - 9:00 = 8æ™‚é–“
ï¼ˆä¼‘æ†©æ™‚é–“ã‚’é™¤ãå®Ÿåƒæ™‚é–“ãŒæ³•å®šåŠ´åƒæ™‚é–“ã¨ãªã‚‹ï¼‰
```

---

## work-analysis APIã¨ã®é€£æº

### APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```typescript
POST /work-analysis
{
  "staffId": "staff-001",
  "workStartTime": "09:00",
  "workEndTime": "16:30",
  "date": "2024-01-15"
}
```

### APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼ˆæ—©é€€ã®å ´åˆï¼‰
```typescript
{
  "staffId": "staff-001",
  "date": "2024-01-15",
  "workStartTime": "09:00",
  "workEndTime": "16:30",
  "earlyOvertime": false,
  "overtime": false,
  "earlyLeave": true,           // âœ¨ æ—©é€€ã¨ã—ã¦åˆ¤å®š
  "lateNightOvertimeHours": 0
}
```

---

## UIè¡¨ç¤º

### ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ·±å¤œæ™‚é–“å¸¯è¨­å®š                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ·±å¤œé–‹å§‹æ™‚åˆ»ï¼ˆæ™‚ï¼‰ [22]                       â”‚
â”‚ æ·±å¤œçµ‚äº†æ™‚åˆ»ï¼ˆæ™‚ï¼‰ [5]                        â”‚
â”‚ æ—©å‡ºæ®‹æ¥­åŸºæº–æ™‚é–“ï¼ˆæ™‚ï¼‰ [9]                    â”‚
â”‚ æ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ï¼ˆæ™‚ï¼‰ [17] â¬…ï¸ NEW           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‹¤æ€ å…¥åŠ›ç”»é¢ï¼ˆãƒãƒƒã‚¸è¡¨ç¤ºï¼‰

æ—©ä¸ŠãŒã‚Šã§é€€å‹¤ã—ãŸå ´åˆã€ä»¥ä¸‹ã®ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
âš ï¸ æ—©é€€ã‚ã‚Šï¼ˆé»„è‰²ã®ãƒãƒƒã‚¸ï¼‰
```

---

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### ã‚±ãƒ¼ã‚¹1: é€šå¸¸å‹¤å‹™
```
è¨­å®š: earlyLeaveStandardHour = 17
å‡ºå‹¤: 09:00
é€€å‹¤: 17:00
ä¼‘æ†©: 60åˆ†

æœŸå¾…ã•ã‚Œã‚‹çµæœ:
- earlyLeave: false
- ãƒãƒƒã‚¸: ãªã—
```

### ã‚±ãƒ¼ã‚¹2: æ—©ä¸ŠãŒã‚Šï¼ˆä½“èª¿ä¸è‰¯ãªã©ï¼‰
```
è¨­å®š: earlyLeaveStandardHour = 17
å‡ºå‹¤: 09:00
é€€å‹¤: 15:00
ä¼‘æ†©: 60åˆ†

æœŸå¾…ã•ã‚Œã‚‹çµæœ:
- earlyLeave: true
- ãƒãƒƒã‚¸: âš ï¸ æ—©é€€ã‚ã‚Š
```

### ã‚±ãƒ¼ã‚¹3: åŠæ—¥å‹¤å‹™
```
è¨­å®š: earlyLeaveStandardHour = 17
å‡ºå‹¤: 09:00
é€€å‹¤: 13:00
ä¼‘æ†©: 0åˆ†

æœŸå¾…ã•ã‚Œã‚‹çµæœ:
- earlyLeave: true
- ãƒãƒƒã‚¸: âš ï¸ æ—©é€€ã‚ã‚Š
```

### ã‚±ãƒ¼ã‚¹4: æ®‹æ¥­ï¼ˆæ—©é€€ã§ã¯ãªã„ï¼‰
```
è¨­å®š: earlyLeaveStandardHour = 17
å‡ºå‹¤: 09:00
é€€å‹¤: 20:00
ä¼‘æ†©: 60åˆ†

æœŸå¾…ã•ã‚Œã‚‹çµæœ:
- earlyLeave: false
- overtime: true
- ãƒãƒƒã‚¸: ğŸ• æ®‹æ¥­ã‚ã‚Š
```

---

## ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ

### è¨­å®šä¿å­˜æ™‚

```
1. ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç”»é¢ã§ã€Œæ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ã€ã‚’å…¥åŠ›
   â†“
2. ã€Œè¨­å®šã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
3. systemSettingsApi.save() ãŒå®Ÿè¡Œã•ã‚Œã‚‹
   â†“
4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
   â†“
5. work-analysis APIãŒæ–°ã—ã„è¨­å®šã‚’ä½¿ç”¨
```

### å‹¤æ€ åˆ†ææ™‚

```
1. å‹¤æ€ ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›
   â†“
2. work-analysis APIã‚’å‘¼ã³å‡ºã™
   â†“
3. ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‹ã‚‰ earlyLeaveStandardHour ã‚’å–å¾—
   â†“
4. é€€å‹¤æ™‚åˆ» < earlyLeaveStandardHour ã‚’åˆ¤å®š
   â†“
5. çµæœã‚’è¿”ã™ï¼ˆearlyLeave: true/falseï¼‰
   â†“
6. ãƒãƒƒã‚¸ã‚’è¡¨ç¤º
```

---

## ãƒ¡ãƒªãƒƒãƒˆ

### 1. **æŸ”è»Ÿãªå‹¤å‹™æ™‚é–“ç®¡ç†**
- ä¼æ¥­ã”ã¨ã®å®šæ™‚é€€å‹¤æ™‚åˆ»ã«å¯¾å¿œ
- ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ åˆ¶ã«ã‚‚å¯¾å¿œå¯èƒ½

### 2. **æ­£ç¢ºãªæ—©é€€åˆ¤å®š**
- å®šæ™‚ã‚ˆã‚Šå‰ã®é€€å‹¤ã‚’è‡ªå‹•çš„ã«åˆ¤å®š
- ç®¡ç†è€…ãŒç›®è¦–ç¢ºèªã™ã‚‹å¿…è¦ãŒãªããªã‚‹

### 3. **çµ¦ä¸è¨ˆç®—ã¸ã®æ´»ç”¨**
- æ—©é€€æ™‚é–“ã‚’æ­£ç¢ºã«è¨˜éŒ²
- çµ¦ä¸æ§é™¤ãªã©ã®å‡¦ç†ã«æ´»ç”¨å¯èƒ½

### 4. **ç›£æŸ»è¨¼è·¡**
- ã„ã¤æ—©é€€ã—ãŸã‹ãŒè¨˜éŒ²ã•ã‚Œã‚‹
- å‹¤æ€ ç®¡ç†ã®é€æ˜æ€§å‘ä¸Š

---

## æ³¨æ„äº‹é …

### è¨­å®šå¤‰æ›´ã®å½±éŸ¿

- **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿**: è¨­å®šå¤‰æ›´ã¯æ—¢å­˜ã®å‹¤æ€ ãƒ‡ãƒ¼ã‚¿ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“
- **æ–°è¦ãƒ‡ãƒ¼ã‚¿**: å¤‰æ›´å¾Œã®å‹¤æ€ å…¥åŠ›ã‹ã‚‰æ–°ã—ã„åŸºæº–ãŒé©ç”¨ã•ã‚Œã¾ã™
- **å†åˆ†æ**: éå»ãƒ‡ãƒ¼ã‚¿ã‚’å†åˆ†æã™ã‚‹å ´åˆã€æ–°ã—ã„åŸºæº–ã§åˆ¤å®šã•ã‚Œã¾ã™

### æ¨å¥¨è¨­å®š

```typescript
// æ¨™æº–çš„ãªä¼æ¥­ã®å ´åˆ
earlyOvertimeStandardHour: 9,    // 9æ™‚å§‹æ¥­
earlyLeaveStandardHour: 17,      // 17æ™‚çµ‚æ¥­

// ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ åˆ¶ã®å ´åˆ
earlyOvertimeStandardHour: 10,   // ã‚³ã‚¢ã‚¿ã‚¤ãƒ é–‹å§‹
earlyLeaveStandardHour: 15,      // ã‚³ã‚¢ã‚¿ã‚¤ãƒ çµ‚äº†
```

---

## ã¾ã¨ã‚

### âœ… å®Ÿè£…å®Œäº†

1. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«è¿½åŠ **
   - `SystemSettings`ã«`earlyLeaveStandardHour`ã‚’è¿½åŠ 
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: 17æ™‚

2. **UIå®Ÿè£…**
   - ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç”»é¢ã«å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
   - æ·±å¤œæ™‚é–“å¸¯è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«é…ç½®

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº**
   - APIã«ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼ˆå‰ææ¡ä»¶ã‚ˆã‚Šï¼‰
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰è¨­å®šã‚’ä¿å­˜ãƒ»å–å¾—å¯èƒ½

### ğŸ¯ çµæœ

- âœ… ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã§æ—©ä¸ŠãŒã‚ŠåŸºæº–æ™‚åˆ»ã‚’è¨­å®šå¯èƒ½
- âœ… work-analysis APIãŒè¨­å®šå€¤ã‚’ä½¿ç”¨
- âœ… æ—©é€€åˆ¤å®šãŒæ­£ç¢ºã«è¡Œã‚ã‚Œã‚‹
- âœ… å‹¤æ€ å…¥åŠ›ç”»é¢ã§ãƒãƒƒã‚¸è¡¨ç¤ºã•ã‚Œã‚‹

---

**å®Ÿè£…æ—¥**: 2026å¹´2æœˆ13æ—¥  
**å½±éŸ¿ç¯„å›²**: 
- `/utils/api.ts`
- `/components/system-settings-page.tsx`

**APIã¨ã®é€£æº**: å®Œäº†ï¼ˆAPIã«ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼‰
